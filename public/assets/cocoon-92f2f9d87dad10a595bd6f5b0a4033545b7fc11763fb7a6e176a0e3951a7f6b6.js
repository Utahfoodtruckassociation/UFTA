!function(e){var n=0,t=function(){return(new Date).getTime()+n++},a=function(e){return"["+e+"]$1"},i=function(e){return"_"+e+"_$1"},o=function(n,t,a){return n?"function"==typeof n?(t&&console.warn("association-insertion-traversal is ignored, because association-insertion-node is given as a function."),n(a)):"string"==typeof n?t?a[t](n):"this"==n?a:e(n):void 0:a.parent()};e(document).on("click",".add_fields",function(n){n.preventDefault();var r=e(this),s=r.data("association"),c=r.data("associations"),d=r.data("association-insertion-template"),u=r.data("association-insertion-method")||r.data("association-insertion-position")||"before",l=r.data("association-insertion-node"),f=r.data("association-insertion-traversal"),p=parseInt(r.data("count"),10),v=new RegExp("\\[new_"+s+"\\](.*?\\s)","g"),g=new RegExp("_new_"+s+"_(\\w*)","g"),m=t(),_=d.replace(v,a(m)),h=[];for(_==d&&(v=new RegExp("\\[new_"+c+"\\](.*?\\s)","g"),g=new RegExp("_new_"+c+"_(\\w*)","g"),_=d.replace(v,a(m))),h=[_=_.replace(g,i(m))],p=isNaN(p)?1:Math.max(p,1),p-=1;p;)m=t(),_=(_=d.replace(v,a(m))).replace(g,i(m)),h.push(_),p-=1;var w=o(l,f,r);w&&0!=w.length||console.warn("Couldn't find the element to insert the template. Make sure your `data-association-insertion-*` on `link_to_add_association` is correct."),e.each(h,function(n,t){var a=e(t),i=jQuery.Event("cocoon:before-insert");if(w.trigger(i,[a]),!i.isDefaultPrevented()){w[u](a);w.trigger("cocoon:after-insert",[a])}})}),e(document).on("click",".remove_fields.dynamic, .remove_fields.existing",function(n){var t=e(this),a=t.data("wrapper-class")||"nested-fields",i=t.closest("."+a),o=i.parent();n.preventDefault();var r=jQuery.Event("cocoon:before-remove");if(o.trigger(r,[i]),!r.isDefaultPrevented()){var s=o.data("remove-timeout")||0;setTimeout(function(){t.hasClass("dynamic")?i.remove():(t.prev("input[type=hidden]").val("1"),i.hide()),o.trigger("cocoon:after-remove",[i])},s)}}),e(document).on("ready page:load turbolinks:load",function(){e(".remove_fields.existing.destroyed").each(function(){var n=e(this),t=n.data("wrapper-class")||"nested-fields";n.closest("."+t).hide()})})}(jQuery);